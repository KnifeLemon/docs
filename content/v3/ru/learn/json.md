# Обёртка JSON

## Обзор

Класс `Json` в Flight предоставляет простой и последовательный способ кодирования и декодирования данных JSON в вашем приложении. Он оборачивает встроенные функции JSON PHP с улучшенной обработкой ошибок и некоторыми полезными настройками по умолчанию, делая работу с JSON проще и безопаснее.

## Понимание

Работа с JSON очень распространена в современных PHP-приложениях, особенно при создании API или обработке AJAX-запросов. Класс `Json` централизует всё кодирование и декодирование JSON, так что вам не нужно беспокоиться о странных крайних случаях или загадочных ошибках от встроенных функций PHP.

Ключевые особенности:
- Последовательная обработка ошибок (выбрасывает исключения при неудаче)
- Настройки по умолчанию для кодирования/декодирования (например, неэкранированные слеши)
- Утилитные методы для красивой печати и валидации

## Базовое использование

### Кодирование данных в JSON

Чтобы преобразовать данные PHP в строку JSON, используйте `Json::encode()`:

```php
use flight\util\Json;

$data = [
  'framework' => 'Flight',
  'version' => 3,
  'features' => ['routing', 'views', 'extending']
];

$json = Json::encode($data);
echo $json;
// Вывод: {"framework":"Flight","version":3,"features":["routing","views","extending"]}
```

Если кодирование не удастся, вы получите исключение с полезным сообщением об ошибке.

### Красивая печать

Хотите, чтобы JSON был читаемым для человека? Используйте `prettyPrint()`:

```php
echo Json::prettyPrint($data);
/*
{
  "framework": "Flight",
  "version": 3,
  "features": [
    "routing",
    "views",
    "extending"
  ]
}
*/
```

### Декодирование строк JSON

Чтобы преобразовать строку JSON обратно в данные PHP, используйте `Json::decode()`:

```php
$json = '{"framework":"Flight","version":3}';
$data = Json::decode($json);
echo $data->framework; // Вывод: Flight
```

Если вы хотите ассоциативный массив вместо объекта, передайте `true` в качестве второго аргумента:

```php
$data = Json::decode($json, true);
echo $data['framework']; // Вывод: Flight
```

Если декодирование не удастся, вы получите исключение с ясным сообщением об ошибке.

### Валидация JSON

Проверьте, является ли строка валидным JSON:

```php
if (Json::isValid($json)) {
  // Это валидно!
} else {
  // Не валидный JSON
}
```

### Получение последней ошибки

Если вы хотите проверить последнее сообщение об ошибке JSON (из встроенных функций PHP):

```php
$error = Json::getLastError();
if ($error !== '') {
  echo "Последняя ошибка JSON: $error";
}
```

## Расширенное использование

Вы можете настроить опции кодирования и декодирования, если вам нужно больше контроля (см. [опции json_encode в PHP](https://www.php.net/manual/en/json.constants.php)):

```php
// Кодирование с опцией HEX_TAG
$json = Json::encode($data, JSON_HEX_TAG);

// Декодирование с пользовательской глубиной
$data = Json::decode($json, false, 1024);
```

## См. также

- [Collections](/learn/collections) - Для работы со структурированными данными, которые можно легко преобразовать в JSON.
- [Configuration](/learn/configuration) - Как настроить ваше приложение Flight.
- [Extending](/learn/extending) - Как добавить свои утилиты или переопределить основные классы.

## Устранение неисправностей

- Если кодирование или декодирование не удастся, выбрасывается исключение — оберните вызовы в try/catch, если хотите обрабатывать ошибки грациозно.
- Если вы получаете неожиданные результаты, проверьте данные на циклические ссылки или не-UTF8 символы.
- Используйте `Json::isValid()`, чтобы проверить, является ли строка валидным JSON перед декодированием.

## Журнал изменений

- v3.16.0 - Добавлен утилитный класс обёртки JSON.