# Розширення

Flight розроблений як розширювальний фреймворк. Фреймворк постачається з набором
типових методів і компонентів, але дозволяє вам мапувати власні методи,
реєструвати свої власні класи або навіть перевизначати існуючі класи і методи.

Якщо ви шукаєте DIC (Контейнер Впровадження Залежностей), перейдіть на
[Сторінка Контейнера Впровадження Залежностей](dependency-injection-container).

## Мапування Методів

Щоб мапувати свій власний простий користувацький метод, ви використовуєте функцію `map`:

```php
// Мапуйте свій метод
Flight::map('hello', function (string $name) {
  echo "hello $name!";
});

// Викликайте свій користувацький метод
Flight::hello('Bob');
```

Хоча можливо створити прості користувацькі методи, рекомендується просто створювати
стандартні функції в PHP. Це має автозавершення в IDE та легше читається.
Еквівалентом наведеного вище коду буде:

```php
function hello(string $name) {
  echo "hello $name!";
}

hello('Bob');
```

Це більше використовується, коли потрібно передавати змінні у ваш метод для отримання очікуваного
значення. Використання методу `register()` як показано нижче більше для передачі конфігурації
і потім виклику вашого попередньо налаштованого класу.

## Реєстрація Класів

Щоб зареєструвати свій власний клас і налаштувати його, ви використовуєте функцію `register`:

```php
// Реєструйте свій клас
Flight::register('user', User::class);

// Отримайте екземпляр свого класу
$user = Flight::user();
```

Метод реєстрації також дозволяє вам передавати параметри до конструктора вашого класу.
Отже, коли ви завантажуєте свій користувацький клас, він прийде попередньо ініціалізованим.
Ви можете визначити параметри конструктора, передавши додатковий масив.
Ось приклад завантаження підключення до бази даних:

```php
// Реєстрація класу з параметрами конструктора
Flight::register('db', PDO::class, ['mysql:host=localhost;dbname=test', 'user', 'pass']);

// Отримайте екземпляр свого класу
// Це створить об'єкт з визначеними параметрами
//
// new PDO('mysql:host=localhost;dbname=test','user','pass');
//
$db = Flight::db();

// і якщо вам знадобиться це пізніше у вашому коді, просто знову викличте той же метод
class SomeController {
  public function __construct() {
	$this->db = Flight::db();
  }
}
```

Якщо ви передасте додатковий параметр зворотного виклику, він буде виконаний негайно
після створення класу. Це дозволяє вам виконувати будь-які процедури налаштування для вашого
нового об'єкта. Функція зворотного виклику приймає один параметр, екземпляр нового об'єкта.

```php
// Функції зворотного виклику буде передано об'єкт, який був створений
Flight::register(
  'db',
  PDO::class,
  ['mysql:host=localhost;dbname=test', 'user', 'pass'],
  function (PDO $db) {
    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
  }
);
```

За замовчуванням, щоразу, коли ви завантажуєте свій клас, ви отримуєте спільний екземпляр.
Щоб отримати новий екземпляр класу, просто передайте `false` як параметр:

```php
// Спільний екземпляр класу
$shared = Flight::db();

// Новий екземпляр класу
$new = Flight::db(false);
```

Майте на увазі, що маповані методи мають пріоритет над зареєстрованими класами. Якщо ви
оголосите обидва, використовуючи одне й те саме ім'я, буде викликано лише мапований метод.

## Логування

Flight не має вбудованої системи логування, проте дуже просто
використовувати бібліотеку логування з Flight. Ось приклад із використанням бібліотеки Monolog:

```php
// index.php або bootstrap.php

// Реєструйте логер з Flight
Flight::register('log', Monolog\Logger::class, ['name'], function(Monolog\Logger $log) {
    $log->pushHandler(new Monolog\Handler\StreamHandler('path/to/your.log', Monolog\Logger::WARNING));
});
```

Тепер, коли він зареєстрований, ви можете використовувати його у своїй програмі:

```php
// У вашому контролері або маршруті
Flight::log()->warning('Це повідомлення про попередження');
```

Це буде логувати повідомлення у файл журналу, який ви вказали. Що якщо ви хочете записати щось, коли
виникає помилка? Ви можете використовувати метод `error`:

```php
// У вашому контролері або маршруті

Flight::map('error', function(Throwable $ex) {
	Flight::log()->error($ex->getMessage());
	// Відобразіть свою власну сторінку з помилкою
	include 'errors/500.html';
});
```

Ви також можете створити базову систему APM (Моніторинг Продуктивності Застосунків)
використовуючи методи `before` і `after`:

```php
// У вашому файлі завантаження

Flight::before('start', function() {
	Flight::set('start_time', microtime(true));
});

Flight::after('start', function() {
	$end = microtime(true);
	$start = Flight::get('start_time');
	Flight::log()->info('Запит ' . Flight::request()->url . ' зайняв ' . round($end - $start, 4) . ' секунд');

	// Ви також можете додати свої заголовки запиту або відповіді
	// щоб записати їх також (будьте обережні, оскільки це буде 
	// багато даних, якщо у вас багато запитів)
	Flight::log()->info('Заголовки запиту: ' . json_encode(Flight::request()->headers));
	Flight::log()->info('Заголовки відповіді: ' . json_encode(Flight::response()->headers));
});
```

## Перевизначення Методів Фреймворку

Flight дозволяє вам перевизначити його стандартну функціональність, щоб відповідати вашим потребам,
не змінюючи жодного коду. Ви можете переглянути всі методи, які ви можете перевизначити [тут](/learn/api).

Наприклад, коли Flight не може знайти URL, що відповідає маршруту, він викликає метод `notFound`,
який надсилає загальний `HTTP 404` відгук. Ви можете перевизначити цю поведінку
використовуючи метод `map`:

```php
Flight::map('notFound', function() {
  // Відобразіть власну сторінку 404
  include 'errors/404.html';
});
```

Flight також дозволяє вам замінити основні компоненти фреймворку.
Наприклад, ви можете замінити клас Router за замовчуванням на свій власний користувацький клас:

```php
// Реєструйте свій користувацький клас
Flight::register('router', MyRouter::class);

// Коли Flight завантажує екземпляр Router, він завантажить ваш клас
$myrouter = Flight::router();
```

Методи фреймворку, такі як `map` і `register`, однак не можуть бути перевизначені. Ви отримаєте помилку, якщо спробуєте це зробити.