# Обработчик загруженного файла

## Обзор

Класс `UploadedFile` в Flight упрощает и делает безопасной обработку загрузки файлов в вашем приложении. Он оборачивает детали процесса загрузки файлов PHP, предоставляя простой объектно-ориентированный способ доступа к информации о файле и перемещения загруженных файлов.

## Понимание

Когда пользователь загружает файл через форму, PHP сохраняет информацию о файле в суперглобальной переменной `$_FILES`. В Flight вы редко взаимодействуете с `$_FILES` напрямую. Вместо этого объект `Request` Flight (доступный через `Flight::request()`) предоставляет метод `getUploadedFiles()`, который возвращает массив объектов `UploadedFile`, делая обработку файлов гораздо более удобной и надежной.

Класс `UploadedFile` предоставляет методы для:
- Получения оригинального имени файла, типа MIME, размера и временного расположения
- Проверки ошибок загрузки
- Перемещения загруженного файла в постоянное расположение

Этот класс помогает избежать распространенных ошибок при загрузке файлов, таких как обработка ошибок или безопасное перемещение файлов.

## Базовое использование

### Доступ к загруженным файлам из запроса

Рекомендуемый способ доступа к загруженным файлам — через объект запроса:

```php
Flight::route('POST /upload', function() {
    // Для поля формы <input type="file" name="myFile">
    $uploadedFiles = Flight::request()->getUploadedFiles();
    $file = $uploadedFiles['myFile'];

    // Теперь вы можете использовать методы UploadedFile
    if ($file->getError() === UPLOAD_ERR_OK) {
        $file->moveTo('/path/to/uploads/' . $file->getClientFilename());
        echo "Файл успешно загружен!";
    } else {
        echo "Загрузка не удалась: " . $file->getError();
    }
});
```

### Обработка множественной загрузки файлов

Если ваша форма использует `name="myFiles[]"` для множественной загрузки, вы получите массив объектов `UploadedFile`:

```php
Flight::route('POST /upload', function() {
    // Для поля формы <input type="file" name="myFiles[]">
    $uploadedFiles = Flight::request()->getUploadedFiles();
    foreach ($uploadedFiles['myFiles'] as $file) {
        if ($file->getError() === UPLOAD_ERR_OK) {
            $file->moveTo('/path/to/uploads/' . $file->getClientFilename());
            echo "Загружено: " . $file->getClientFilename() . "<br>";
        } else {
            echo "Не удалось загрузить: " . $file->getClientFilename() . "<br>";
        }
    }
});
```

### Создание экземпляра UploadedFile вручную

Обычно вы не создаете `UploadedFile` вручную, но это возможно при необходимости:

```php
use flight\net\UploadedFile;

$file = new UploadedFile(
  $_FILES['myfile']['name'],
  $_FILES['myfile']['type'],
  $_FILES['myfile']['size'],
  $_FILES['myfile']['tmp_name'],
  $_FILES['myfile']['error']
);
```

### Доступ к информации о файле

Вы можете легко получить детали о загруженном файле:

```php
echo $file->getClientFilename();   // Оригинальное имя файла с компьютера пользователя
echo $file->getClientMediaType();  // Тип MIME (например, image/png)
echo $file->getSize();             // Размер файла в байтах
echo $file->getTempName();         // Временный путь к файлу на сервере
echo $file->getError();            // Код ошибки загрузки (0 означает отсутствие ошибки)
```

### Перемещение загруженного файла

После валидации файла переместите его в постоянное расположение:

```php
try {
  $file->moveTo('/path/to/uploads/' . $file->getClientFilename());
  echo "Файл успешно загружен!";
} catch (Exception $e) {
  echo "Загрузка не удалась: " . $e->getMessage();
}
```

Метод `moveTo()` вызовет исключение, если что-то пойдет не так (например, ошибка загрузки или проблема с правами доступа).

### Обработка ошибок загрузки

Если во время загрузки возникла проблема, вы можете получить читаемое сообщение об ошибке:

```php
if ($file->getError() !== UPLOAD_ERR_OK) {
  // Вы можете использовать код ошибки или поймать исключение от moveTo()
  echo "Произошла ошибка при загрузке файла.";
}
```

## См. также

- [Requests](/learn/requests) - Узнайте, как получать доступ к загруженным файлам из HTTP-запросов и увидеть больше примеров загрузки файлов.
- [Configuration](/learn/configuration) - Как настроить лимиты загрузки и директории в PHP.
- [Extending](/learn/extending) - Как настроить или расширить основные классы Flight.

## Устранение неисправностей

- Всегда проверяйте `$file->getError()` перед перемещением файла.
- Убедитесь, что директория загрузки доступна для записи веб-сервером.
- Если `moveTo()` не срабатывает, проверьте сообщение исключения для деталей.
- Настройки PHP `upload_max_filesize` и `post_max_size` могут ограничивать загрузку файлов.
- Для множественной загрузки файлов всегда проходите циклом по массиву объектов `UploadedFile`.

## Журнал изменений

- v3.12.0 - Добавлен класс `UploadedFile` в объект запроса для упрощения обработки файлов.