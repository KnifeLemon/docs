# Коллекции

## Обзор

Класс `Collection` в Flight — это удобная утилита для управления наборами данных. Она позволяет обращаться к данным и манипулировать ими с использованием как нотации массива, так и нотации объекта, делая ваш код чище и более гибким.

## Понимание

`Collection` — это по сути обертка вокруг массива, но с дополнительными возможностями. Вы можете использовать его как массив, перебирать, подсчитывать элементы и даже обращаться к элементам как к свойствам объекта. Это особенно полезно, когда вы хотите передавать структурированные данные в вашем приложении или сделать код более читаемым.

Коллекции реализуют несколько интерфейсов PHP:
- `ArrayAccess` (чтобы вы могли использовать синтаксис массива)
- `Iterator` (чтобы вы могли перебирать с помощью `foreach`)
- `Countable` (чтобы вы могли использовать `count()`)
- `JsonSerializable` (чтобы вы могли легко преобразовать в JSON)

## Основное использование

### Создание коллекции

Вы можете создать коллекцию, просто передав массив в её конструктор:

```php
use flight\util\Collection;

$data = [
  'name' => 'Flight',
  'version' => 3,
  'features' => ['routing', 'views', 'extending']
];

$collection = new Collection($data);
```

### Доступ к элементам

Вы можете обращаться к элементам с использованием нотации массива или объекта:

```php
// Нотация массива
echo $collection['name']; // Вывод: FlightPHP

// Нотация объекта
echo $collection->version; // Вывод: 3
```

Если вы попытаетесь обратиться к ключу, которого не существует, вы получите `null` вместо ошибки.

### Установка элементов

Вы можете устанавливать элементы с использованием любой нотации:

```php
// Нотация массива
$collection['author'] = 'Mike Cao';

// Нотация объекта
$collection->license = 'MIT';
```

### Проверка и удаление элементов

Проверьте, существует ли элемент:

```php
if (isset($collection['name'])) {
  // Сделайте что-то
}

if (isset($collection->version)) {
  // Сделайте что-то
}
```

Удалите элемент:

```php
unset($collection['author']);
unset($collection->license);
```

### Перебор коллекции

Коллекции итерируемы, поэтому вы можете использовать их в цикле `foreach`:

```php
foreach ($collection as $key => $value) {
  echo "$key: $value\n";
}
```

### Подсчет элементов

Вы можете подсчитать количество элементов в коллекции:

```php
echo count($collection); // Вывод: 4
```

### Получение всех ключей или данных

Получите все ключи:

```php
$keys = $collection->keys(); // ['name', 'version', 'features', 'license']
```

Получите все данные как массив:

```php
$data = $collection->getData();
```

### Очистка коллекции

Удалите все элементы:

```php
$collection->clear();
```

### Сериализация JSON

Коллекции легко преобразуются в JSON:

```php
echo json_encode($collection);
// Вывод: {"name":"FlightPHP","version":3,"features":["routing","views","extending"],"license":"MIT"}
```

## Расширенное использование

Вы можете полностью заменить внутренний массив данных, если нужно:

```php
$collection->setData(['foo' => 'bar']);
```

Коллекции особенно полезны, когда вы хотите передавать структурированные данные между компонентами или предоставить более объектно-ориентированный интерфейс для данных массива.

## См. также

- [Requests](/learn/requests) - Узнайте, как обрабатывать HTTP-запросы и как коллекции могут использоваться для управления данными запроса.
- [PDO Wrapper](/learn/pdo-wrapper) - Узнайте, как использовать обертку PDO в Flight и как коллекции могут использоваться для управления результатами базы данных.

## Устранение неисправностей

- Если вы попытаетесь обратиться к ключу, которого не существует, вы получите `null` вместо ошибки.
- Помните, что коллекции не рекурсивны: вложенные массивы не преобразуются автоматически в коллекции.
- Если вам нужно сбросить коллекцию, используйте `$collection->clear()` или `$collection->setData([])`.

## Журнал изменений

- v3.0 - Улучшены подсказки типов и поддержка PHP 8+.
- v1.0 - Первоначальный выпуск класса Collection.