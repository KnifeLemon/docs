# Обробник Завантаженого Файлу

## Огляд

Клас `UploadedFile` у Flight полегшує та робить безпечним обробку завантаження файлів у вашому додатку. Він обгортає деталі процесу завантаження файлів PHP, надаючи вам простий, об'єктно-орієнтований спосіб доступу до інформації про файл та переміщення завантажених файлів.

## Розуміння

Коли користувач завантажує файл через форму, PHP зберігає інформацію про файл у суперглобальній змінній `$_FILES`. У Flight ви рідко взаємодієте з `$_FILES` безпосередньо. Натомість об'єкт `Request` у Flight (доступний через `Flight::request()`) надає метод `getUploadedFiles()`, який повертає масив об'єктів `UploadedFile`, роблячи обробку файлів набагато зручнішою та надійнішою.

Клас `UploadedFile` надає методи для:
- Отримання оригінальної назви файлу, типу MIME, розміру та тимчасового розташування
- Перевірки помилок завантаження
- Переміщення завантаженого файлу до постійного розташування

Цей клас допомагає уникнути поширених помилок з завантаженням файлів, таких як обробка помилок чи безпечне переміщення файлів.

## Основне Використання

### Доступ до Завантажених Файлів з Запиту

Рекомендований спосіб доступу до завантажених файлів — через об'єкт запиту:

```php
Flight::route('POST /upload', function() {
    // Для поля форми з назвою <input type="file" name="myFile">
    $uploadedFiles = Flight::request()->getUploadedFiles();
    $file = $uploadedFiles['myFile'];

    // Тепер ви можете використовувати методи UploadedFile
    if ($file->getError() === UPLOAD_ERR_OK) {
        $file->moveTo('/path/to/uploads/' . $file->getClientFilename());
        echo "Файл успішно завантажено!";
    } else {
        echo "Завантаження не вдалося: " . $file->getError();
    }
});
```

### Обробка Кількох Завантажень Файлів

Якщо ваша форма використовує `name="myFiles[]"` для кількох завантажень, ви отримаєте масив об'єктів `UploadedFile`:

```php
Flight::route('POST /upload', function() {
    // Для поля форми з назвою <input type="file" name="myFiles[]">
    $uploadedFiles = Flight::request()->getUploadedFiles();
    foreach ($uploadedFiles['myFiles'] as $file) {
        if ($file->getError() === UPLOAD_ERR_OK) {
            $file->moveTo('/path/to/uploads/' . $file->getClientFilename());
            echo "Завантажено: " . $file->getClientFilename() . "<br>";
        } else {
            echo "Не вдалося завантажити: " . $file->getClientFilename() . "<br>";
        }
    }
});
```

### Створення Екземпляра UploadedFile Вручну

Зазвичай ви не створюватимете `UploadedFile` вручну, але можете, якщо потрібно:

```php
use flight\net\UploadedFile;

$file = new UploadedFile(
  $_FILES['myfile']['name'],
  $_FILES['myfile']['type'],
  $_FILES['myfile']['size'],
  $_FILES['myfile']['tmp_name'],
  $_FILES['myfile']['error']
);
```

### Доступ до Інформації про Файл

Ви можете легко отримати деталі про завантажений файл:

```php
echo $file->getClientFilename();   // Оригінальна назва файлу з комп'ютера користувача
echo $file->getClientMediaType();  // Тип MIME (наприклад, image/png)
echo $file->getSize();             // Розмір файлу в байтах
echo $file->getTempName();         // Тимчасовий шлях до файлу на сервері
echo $file->getError();            // Код помилки завантаження (0 означає відсутність помилки)
```

### Переміщення Завантаженого Файлу

Після перевірки файлу перемістіть його до постійного розташування:

```php
try {
  $file->moveTo('/path/to/uploads/' . $file->getClientFilename());
  echo "Файл успішно завантажено!";
} catch (Exception $e) {
  echo "Завантаження не вдалося: " . $e->getMessage();
}
```

Метод `moveTo()` викличе виняток, якщо щось піде не так (наприклад, помилка завантаження чи проблема з правами доступу).

### Обробка Помилок Завантаження

Якщо під час завантаження виникла проблема, ви можете отримати повідомлення про помилку, зрозуміле для людини:

```php
if ($file->getError() !== UPLOAD_ERR_OK) {
  // Ви можете використовувати код помилки або зловити виняток від moveTo()
  echo "Виникла помилка під час завантаження файлу.";
}
```

## Дивіться Також

- [Requests](/learn/requests) - Дізнайтеся, як доступатися до завантажених файлів з HTTP-запитів та перегляньте більше прикладів завантаження файлів.
- [Configuration](/learn/configuration) - Як налаштувати ліміти завантаження та директорії в PHP.
- [Extending](/learn/extending) - Як налаштувати або розширити основні класи Flight.

## Вирішення Проблем

- Завжди перевіряйте `$file->getError()` перед переміщенням файлу.
- Переконайтеся, що директорія завантаження доступна для запису веб-сервером.
- Якщо `moveTo()` не вдається, перевірте повідомлення винятку для деталей.
- Налаштування `upload_max_filesize` та `post_max_size` у PHP можуть обмежувати завантаження файлів.
- Для кількох завантажень файлів завжди перебирайте масив об'єктів `UploadedFile`.

## Журнал Змін

- v3.12.0 - Додано клас `UploadedFile` до об'єкта запиту для легшої обробки файлів.